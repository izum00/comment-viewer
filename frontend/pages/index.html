<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>YouTube Live Chat Viewer</title>
  <style>
    body { font-family: sans-serif; }
    #chat { border: 1px solid #ccc; padding: 8px; height: 300px; overflow-y: auto; }
  </style>
</head>
<body>
  <h1>YouTube Live Chat Viewer</h1>

  <input id="url" placeholder="https://www.youtube.com/live/xxxx" size="50" />
  <button id="connect">接続</button>

  <div id="chat"></div>

  <script>
    let timer = null;

    document.getElementById("connect").onclick = () => {
      const url = document.getElementById("url").value;
      const liveId = url.split("/").pop();

      if (timer) clearInterval(timer);

      timer = setInterval(async () => {
        const res = await fetch(`/api/chat?liveId=${liveId}`);
        const data = await res.json();

        const chat = document.getElementById("chat");
        chat.innerHTML = "";
        data.forEach(c => {
          const div = document.createElement("div");
          div.textContent = `[${c.author}] ${c.message}`;
          chat.appendChild(div);
        });
      }, 3000);
    };
  </script>
</body>
</html>
