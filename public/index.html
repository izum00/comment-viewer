<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>YouTube Live Chat Viewer</title>
  <style>
    body { font-family: sans-serif; }
    #chat { border: 1px solid #ccc; height: 400px; overflow-y: auto; padding: 8px; }
  </style>
</head>
<body>
  <h1>YouTube Live コメントビューア</h1>

  <input id="url" type="text" placeholder="YouTube Live URL" size="60" />
  <button id="connect">接続</button>

  <div id="chat"></div>

  <script>
    const chatDiv = document.getElementById("chat");
    const ws = new WebSocket(
      location.protocol === "https:"
        ? `wss://${location.host}`
        : `ws://${location.host}`
    );

    ws.onmessage = (e) => {
      const data = JSON.parse(e.data);
      if (data.type === "chat") {
        const div = document.createElement("div");
        div.textContent = `${data.author}: ${data.message}`;
        chatDiv.appendChild(div);
        chatDiv.scrollTop = chatDiv.scrollHeight;
      }
    };

    document.getElementById("connect").onclick = () => {
      const url = document.getElementById("url").value;
      const liveId = new URL(url).searchParams.get("v");

      ws.send(
        JSON.stringify({
          type: "connect",
          liveId,
        })
      );
    };
  </script>
</body>
</html>
